<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Панель администрирования</title>
    <link rel="stylesheet" href="/assets/css/ng-admin.min.css">
</head>
<body ng-app="myApp">
<div ui-view></div>
<script src="/assets/js/ng-admin.min.js"></script>
<script type="text/javascript">
    var myApp = angular.module('myApp', ['ng-admin']);
    myApp.config(['NgAdminConfigurationProvider', function(nga) {
        // create an admin application
        var admin = nga.application('Панель администрирования').baseApiUrl('{{apiUrl}}'); // main API endpoint;

        var role = nga.entity('roles');
        role.listView().title('Роли').fields([
            nga.field('name').isDetailLink(true).label("Название")
        ]);
        role.creationView().title('Создание роли').fields([
            nga.field('name').validation({ required: true, maxlength: 100 }).label("Название")
        ]);
        role.editionView().fields(role.creationView().fields()).title('Редактирование роли');
        admin.addEntity(role);

        // create a user entity
        var user = nga.entity('users');
        // set the fields of the user entity list view
        user.listView().title('Список пользователей').fields([
            nga.field('firstName').label("Имя"),
            nga.field('lastName').label("Фамилия"),
            nga.field('email').isDetailLink(true),
            nga.field('roles', 'reference_many').label("Роли")
                    .targetEntity(role)
                    .targetField(nga.field('name'))
                    .singleApiCall(ids => ({'id': ids }))
        ]);
        user.creationView().title('Новый пользователь').fields([
            nga.field('firstName').validation({ required: true, minlength: 3, maxlength: 100 }).label("Имя"),
            nga.field('lastName').validation({ required: true, minlength: 3, maxlength: 100 }).label("Фамилия"),
            nga.field('email', 'email').validation({ required: true }),
            nga.field('password').label('Пароль'),
            nga.field('roles', 'reference_many').label("Роли")
                    .targetEntity(role)
                    .targetField(nga.field('name'))
                    .attributes({ placeholder: 'Select some roles...' })
                    .remoteComplete(true, {
                        refreshDelay: 300 ,
                        searchQuery: search => ({ q: search })
                    }),
            nga.field('street').label("Улица"),
            nga.field('city').label("Город"),
            nga.field('zipcode').label('Индекс').validation({ pattern: '[A-Z\-0-9]{5,10}' }),
            nga.field('phone').label("Телефон"),
            nga.field('website').label("Сайт")
                    .validation({ validator: function(value) {
                        if (!value) return;
                        if (value.indexOf('http://') !== 0) throw new Error ('Invalid url in website');
                    } })
        ]);
        // use the same fields for the editionView as for the creationView
        user.editionView().title('Редактирование пользователя').fields(user.creationView().fields());
        // add the user entity to the admin application
        admin.addEntity(user);

        admin.menu(nga.menu()
            .addChild(nga.menu(user).icon('<span class="glyphicon glyphicon-user"></span>').title('Пользователи'))
            .addChild(nga.menu(role).icon('<span class="glyphicon glyphicon-hand-right"></span>').title('Роли'))
            .addChild(nga.menu().title('Прочее')
                    .addChild(nga.menu().title('Stats').link('/stats').active(function(path) {
                        return path.indexOf('/stats') === 0;
                    }))
            )
        );

        admin.dashboard(nga.dashboard()
            .addCollection(nga.collection(user).name('users').title('Пользователи').fields(user.listView().fields()))
            .addCollection(nga.collection(role).name('roles').title('Роли').fields(role.listView().fields()))
        );

        // attach the admin application to the DOM and run it
        nga.configure(admin);
    }]);



</script>

</body>
</html>