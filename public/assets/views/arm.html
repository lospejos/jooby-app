<div class="row">
    <div class="">
        <ma-view-actions><ma-back-button></ma-back-button></ma-view-actions>
        <div class="page-header">
            <h2>Обработка заказов</h2>
        </div>
    </div>

    <div class="container">
        <div class="row match-my-cols">
            <div class="col-sm-4 same-height">
                <h3>Список заказов <span class="count ">{{newOrders}}</span></h3><hr/>
                <div class="box">
                    <table class="grid table order-list ">
                        <thead>
                        <tr>
                            <th class="ng-admin-type-string">Номер</th>
                            <th class="ng-admin-type-datetime">Дата</th>
                            <th class="ng-admin-type-string">Статус</th>
                            <th class="ng-admin-type-string">Сумма</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr ng-repeat="order in orders" ng-click="onClick(order)" ng-class="rowClass(order)">
                            <td>
                                {{order.orderNumber}}
                            </td>
                            <td>
                                {{order.orderDate | date : "dd-MM-yyyy"}}
                            </td>
                            <td>
                                {{order.status}}
                            </td>
                            <td class="text-right">
                                {{order.totalPrice}}
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="col-sm-4 same-height">
                <form name="form" class="css-form" novalidate>
                <div class="box" ng-if="order">
                    <h3>{{order.name}} <span class="right"><a href="tel:{{order.phone}}">{{order.phone}}</a></span></h3><hr/>
                    <div class="form-group row">
                        <label class="col-sm-4 col-form-label">Заказ:</label>
                        <div class="col-sm-8">
                            <strong><p class="form-control-static mb-0">
                                    <a target="_blank" href="#/orders/edit/{{order.id}}">{{order.orderNumber}}</a> / {{order.orderDate | date : "dd-MM-yyyy"}}
                            </p></strong>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-sm-4 col-form-label">Статус:</label>
                        <div class="col-sm-8">
                            <input class="form-control" type="text" value="{{order.status}}" readonly>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-sm-4 col-form-label">Оплата:</label>
                        <div class="col-sm-8">
                            <input class="form-control" type="text" value="{{order.paymentType.description}}" readonly>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="deliverySelect" class="col-sm-4 col-form-label">Доставка:</label>
                        <div class="col-sm-8">
                            <button id="deliverySelect" type="button" class="btn btn-default form-control" ng-model="order.delivery"
                                    data-html="1" data-placeholder="Выберите значение"
                                    bs-options="item as item.description for item in deliveryTypes track by item.id" bs-select>
                                 <span class="caret"></span>
                            </button>
                        </div>
                    </div>
                    <div class="form-group row {{form.deliveryDate.$error.required? 'has-error' : '' }}">
                        <label for="deliveryDate" class="col-sm-4 col-form-label">Дата доставки:</label>
                        <div class="col-sm-8">
                            <input class="form-control" name="deliveryDate" required="" type="date" ng-model="order.deliveryDate"
                                   ng-change="onDeliveryDateChange(order.deliveryDate)" id="deliveryDate" min="{{today}}">
                        </div>
                    </div>

                    <div class="form-group row {{form.deliveryTime.$error.required? 'has-error' : '' }}">
                        <label for="deliveryTime" class="col-sm-4 col-form-label">Интервал:</label>
                        <div class="col-sm-8">
                            <button id="deliveryTime" required="" name="deliveryTime" type="button" class="btn btn-default form-control"
                                    ng-model="order.deliveryTime" bs-options="item.value as item.value for item in times1 track by item.value" bs-select
                                    ng-change="onDeliveryTimeChange(order.deliveryTime)" data-placeholder="Выберите время">
                                <span class="caret"></span>
                            </button>
                        </div>
                    </div>

                    <div class="form-group row">
                        <label class="col-sm-4 col-form-label">Улица:</label>
                        <div class="col-sm-8">
                            <input class="form-control" type="search" ng-model="order.streetName" data-animation="am-flip-x"
                                   bs-options="address as address for address in getAddress($viewValue)"  bs-typeahead>
                        </div>
                    </div>
                    <!--<i class="fa fa-home"></i> -->

                    <div class="form-group row inline-inputs">
                        <label class="col-sm-4 col-form-label">Дом/под./кв.:</label>
                        <div class="col-sm-3" style="padding-right: 0">
                            <input class="form-control" type="text" ng-model="order.streetNumber">
                        </div>
                        <div class="col-sm-2" style="padding-right: 0; padding-left: 2px">
                            <input class="form-control" type="text" ng-model="order.entrance">
                        </div>
                        <div class="col-sm-3" style="padding-left: 2px">
                            <input class="form-control" type="text" ng-model="order.flat">
                        </div>
                    </div>


                    <div class="form-group row">
                        <label class="col-sm-4 col-form-label">Координаты:</label>
                        <div class="col-sm-4">
                            <input class="form-control" type="text" value="{{order.lat}}" readonly>
                        </div>
                        <div class="col-sm-4">
                            <input class="form-control" type="text" value="{{order.lng}}" readonly>
                        </div>
                    </div>

                    <div class="form-group row">
                        <label class="col-sm-4 col-form-label">Сумма:</label>
                        <div class="col-sm-8">
                            <input class="form-control" type="text" value="{{order.totalPrice}}" readonly>
                        </div>
                    </div>

                    <div style="padding-top: 20px"></div>
                    <table class="table-striped table">
                        <tbody>
                        <tr ng-repeat="entry in order.entries" ng-click="onOrderEntryClick()">
                            <td>
                                <table>
                                    <tr>{{entry.product.name}}</tr>
                                    <tr ng-repeat="sauce in entry.sauces" class="entries collapse out">
                                        <td><small>{{sauce.name}}</small></td>
                                    </tr>
                                </table>
                            </td>
                            <td>
                                {{entry.color.name}}
                            </td>
                            <td class="text-right">
                                {{entry.totalPrice}}
                            </td>
                        </tr>
                        </tbody>
                    </table>

                    <div class="form-group row">
                        <div class="col-sm-4">
                            <button class="btn btn-danger btn-lg btn-block">Отменить</button>
                        </div>
                        <div class="col-sm-8">
                            <button ng-click="submit(order)" type="submit" class="btn btn-primary btn-lg btn-block" ng-disabled="form.$invalid">
                                <span class="glyphicon glyphicon-ok"></span>&nbsp;&nbsp;В доставку
                            </button>
                        </div>
                    </div>
                    <!--<pre>{{form | json}}</pre>-->
                </div>
                </form>
            </div>
            <div class="col-sm-4 same-height">
                <div class="box" ng-if="order.deliveryDate">
                    <h3>График доставки<span class="right">{{order.deliveryDate | date : "dd/MM/yyyy"}}</span></h3>
                    <accordion close-others="true">
                        <accordion-group heading="{{time.value}}" ng-repeat="time in times1" is-open="time.open">
                            <table class="table grid">
                                <tbody>
                                <tr ng-repeat="order in schedule[time.value]" ng-class="scheduleRowClass(order)">
                                    <td>
                                        <a target="_blank" href="#/orders/edit/{{order.id}}">{{order.orderNumber}}</a>
                                    </td>
                                    <td>
                                        {{order.streetName}}&nbsp;{{order.streetNumber}}
                                    </td>
                                    <td class="text-right">
                                        {{order.totalPrice}}
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                            <div id="map_canvas" ng-show="schedule[time.value].length">
                                <ui-gmap-google-map center="map.center" zoom="map.zoom" draggable="true" options="options">
                                    <ui-gmap-marker ng-repeat="marker in markers" coords="marker.coords" options="marker.options" idkey="marker.id">
                                    </ui-gmap-marker>
                                </ui-gmap-google-map>
                            </div>
                            <div ng-hide="schedule[time.value].length">
                                Пока нет заказов
                            </div>
                        </accordion-group>
                    </accordion>
                </div>
                <!--<pre>{{schedule | json}}</pre>-->
            </div>
        </div>
        <div id="loadingDiv" style="display: {{loading? 'block' : 'none'}}">
            <div>
                <h7>Загрузка...</h7>
            </div>
        </div>
    </div>
</div>

<style>
    .map-responsive{
        overflow:hidden;
        /*padding-bottom:56.25%;*/
        position:relative;
        /*height:100px;*/
    }
    #map_canvas {
        height: 200px;
        width: 100%;
        margin: 0px;
    }

    #map_canvas {
        position: relative;
    }

    .angular-google-map-container {
        position: absolute;
        top: 0;
        bottom: 0;
        right: 0;
        left: 0;
    }
    #loadingDiv{
        position:fixed;
        top:0px;
        right:0px;
        width:100%;
        height:100%;
        background-color:#666;
        background-image:url('/assets/image/gears.gif');
        background-repeat:no-repeat;
        background-position:center;
        z-index:10000000;
        opacity: 0.8;
        filter: alpha(opacity=80); /* For IE8 and earlier */
    }

    a {
        cursor: pointer;
        cursor: hand;
    }
    .dropdown-menu{
        width: 90%;
    }
    .inline-inputs input{
        float:left;
    }
    h3 {
        margin-top: 10px;
    }
    hr {
        margin: 3px;
    }
    .count {
        display: inline-block;
        text-align: center;
        background-color: #dff0d8;
        color: #171616;
        font-weight: 700;
        font-size: 15px;
        min-width: 30px;
        height: 30px;
        line-height: 30px;
        border-radius: 30px;
        margin-bottom: -10px;
    }
    /*equal height*/
    [class*="same-height"] {
        padding-top: 1rem;
        padding-bottom: 1rem;
        /*!*background-color: rgba(86,61,124,.15);*!*/
        border: 1px solid rgba(86,61,124,.2);
    }
    .row.match-my-cols {
        overflow: hidden;
    }
    .row.match-my-cols [class*="same-height"]{
        margin-bottom: -999999px;
        padding-bottom: 999999px;
    }
    .row-selected {
        outline: solid black;
        font-weight: bold;
    }
    .col-form-label {
        margin-top: 5px;
        /*width: 30%;*/
    }
    .container {
        margin: 0;
        margin-top: -15px;
        width: 100%;
    }
    .form-control-static {
        padding-top: 5px;
    }
    .form-group {
        margin-bottom: 3px;
    }
    .order-list tr:not(.bg-success):hover {
        background-color: rgba(193, 195, 191, 0.15);
    }
    .order-list tr:not(.processed):hover {
        background-color: rgba(23, 118, 9, 0.71);
    }
    .form-control {
        text-align: left;
    }
    .caret {
        float: right;
        /*vertical-align: middle;*/
        margin-top: 6px;
    }
    .right {
        float: right;
    }
</style>
<!--<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAwn3SpHj61PVeyKuxkZSxcIprf1keZhXI"-->
        <!--async defer></script>-->
<!--<link href="https://code.google.com/apis/maps/documentation/javascript/examples/standard.css" rel="stylesheet" type="text/css" />-->
<!--<script type="text/javascript" src="https://maps.google.com/maps/api/js?key=AIzaSyAwn3SpHj61PVeyKuxkZSxcIprf1keZhXI"></script>-->
</body>
